SET FLAGS INSTEAD OF ALL THESE CONDITIONS FOR INPUT, WHAT CONTEXT IS WHEN, ETC